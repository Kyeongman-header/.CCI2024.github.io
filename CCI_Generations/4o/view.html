<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCI Output with Images</title>
    <style>
        .keyword {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 20px;
        }
        hr {
            margin: 20px 0;
            border: 0;
            border-top: 1px solid #ccc;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
        }
        .image-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .image-container img {
            width: 32%; /* 화면을 3등분 */
            height: auto;
            border: 1px solid #ccc;
        }
        .image-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            text-align: center;
        }
        .image-labels div {
            width: 32%;
            text-align: center;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .text-box {
            white-space: pre-wrap;
            padding: 20px;
            background-color: #fafafa;
            border: 1px solid #ccc;
            overflow-y: auto;
            max-height: 500px;
        }
        footer {
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>CCI Output</h1>

    <!-- 이미지 3장 추가 -->
    <div class="image-container">
        <img id="back_img" src="" alt="Background Image">
        <img id="char_img" src="" alt="Character Image">
        <img id="climax_img" src="" alt="Climax Image">
    </div>

    <!-- 이미지 레이블 -->
    <div class="image-labels">
        <div>Background</div>
        <div>Character</div>
        <div>Climax</div>
    </div>

    <!-- 텍스트 출력 -->
    <div class="container">
        <div class="text-box" id="output_box">
            <!-- CCI 파일 내용이 여기에 들어갑니다 -->
        </div>
    </div>

    <footer>
        <p>© 2024 A Character-Centric Creative Story Generation via Imagination</p>
    </footer>

    <script>
        // URL에서 n 파라미터 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const outputNumber = urlParams.get('n') || '1'; // n 값이 없으면 1로 기본 설정

        // 이미지 파일의 숫자는 텍스트 넘버보다 1 낮음
        const imageNumber = outputNumber - 1;

        // CCI 텍스트 파일 경로 설정
        const cciFile = `https://raw.githubusercontent.com/Kyeongman-header/CCI2024/master/4o/CCI_4o/CCI_4o_${outputNumber}.txt`;

        // 이미지 파일 경로 설정 (1 낮은 숫자 적용)
        const backImg = `https://raw.githubusercontent.com/Kyeongman-header/CCI2024/master/4o/CCI_4o/1_${imageNumber}_background.jpg`;
        const charImg = `https://raw.githubusercontent.com/Kyeongman-header/CCI2024/master/4o/CCI_4o/1_${imageNumber}_character-1.jpg`;
        const climaxImg = `https://raw.githubusercontent.com/Kyeongman-header/CCI2024/master/4o/CCI_4o/1_${imageNumber}_climax.jpg`;

        // 이미지 로드
        document.getElementById('back_img').src = backImg;
        document.getElementById('char_img').src = charImg;
        document.getElementById('climax_img').src = climaxImg;

        // CCI 파일 불러와서 내용 표시
        // fetch(cciFile)
        //     .then(response => response.text())
        //     .then(data => {
        //         // 키워드 배열 (여기에 필요한 키워드 추가 가능)
        //         const keywords = ["Title:", "Characters:", "Background:", "Main Plot:", "Story:"];

        //         // 텍스트 내용 수정 (줄바꿈 및 키워드 강조)
        //         let formattedText = data;
        //         keywords.forEach(keyword => {
        //             const regex = new RegExp(keyword, "g");
        //             formattedText = formattedText.replace(regex, `<hr><span class="keyword">${keyword}</span>`);
        //         });

        //         // 변환된 내용을 텍스트 박스에 삽입
        //         document.getElementById('output_box').innerHTML = formattedText;
        //     });
        fetch(cciFile)
            .then(response => response.text())
            .then(data => {
                // 키워드 배열 (여기에 필요한 키워드 추가 가능)
                const keywords = ["Title:", "Characters:", "Background:", "Main Plot:", "Story:"];

                // Background 관련 처리를 위한 정규식 (Background부터 다음 키워드 전까지)
                const backgroundRegex = /Background:(.*?)(?=Main Plot:|Story:|$)/gs;

                // 텍스트 내용 수정 (줄바꿈 및 키워드 강조)
                let formattedText = data;
                keywords.forEach(keyword => {
                    const regex = new RegExp(keyword, "g");
                    formattedText = formattedText.replace(regex, `<hr><span class="keyword">${keyword}</span>`);
                });

                // Background 관련 내용 추출 및 변환
                const backgroundMatches = formattedText.match(backgroundRegex);
                if (backgroundMatches) {
                    backgroundMatches.forEach(match => {
                        // 매치된 Background 섹션을 강조 (추출된 내용 포함)
                        const cleanedMatch = match.replace(/(Background:\s*Dramatic Background:)/g, "Dramatic Background:");
                        const highlightedMatch = `<hr><span class="keyword">Background:</span>${cleanedMatch.trim()}`;
                        formattedText = formattedText.replace(match, highlightedMatch);
                    });
                }

                // 변환된 내용을 텍스트 박스에 삽입
                document.getElementById('output_box').innerHTML = formattedText;
            });

    </script>

</body>
</html>
